{"version":3,"file":"index.js","sources":["../dist-src/setHeaders.js","../dist-src/vercelApollo.js","../dist-src/ApolloServer.js"],"sourcesContent":["export const setHeaders = (res, headers) => {\n  for (const [name, value] of Object.entries(headers)) {\n    res.setHeader(name, value);\n  }\n};","import { runHttpQuery, convertNodeHttpToRequest } from \"apollo-server-core\";\nimport { setHeaders } from \"./setHeaders.js\";\nexport function graphqlVercel(options) {\n  if (!options) throw new Error(`Apollo Server requires options.`);\n\n  if (arguments.length > 1) {\n    throw new Error(`Apollo Server expects exactly one argument, got ${arguments.length}`);\n  }\n\n  const graphqlHandler = async (req, res) => {\n    if (req.method === `POST` && !req.body) {\n      return res.status(500).send(`POST body missing.`);\n    }\n\n    try {\n      const {\n        graphqlResponse,\n        responseInit\n      } = await runHttpQuery([req, res], {\n        method: req.method,\n        options,\n        query: req?.body || req.query,\n        request: convertNodeHttpToRequest(req)\n      });\n      setHeaders(res, responseInit.headers ?? {});\n      return res.status(200).send(graphqlResponse);\n    } catch (error) {\n      const {\n        headers,\n        statusCode,\n        message\n      } = error;\n      setHeaders(res, headers ?? {});\n      return res.status(statusCode).send(message);\n    }\n  };\n\n  return graphqlHandler;\n}","function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Readable } from \"stream\";\nimport { ApolloServerBase, formatApolloErrors, processFileUploads } from \"apollo-server-core\";\nimport { renderPlaygroundPage } from \"@apollographql/graphql-playground-html\";\nimport { Headers } from 'node-fetch';\nimport { graphqlVercel } from \"./vercelApollo.js\";\nimport { setHeaders } from \"./setHeaders.js\";\nexport class FileUploadRequest extends Readable {\n  constructor(...args) {\n    super(...args);\n\n    _defineProperty(this, \"headers\", void 0);\n  }\n\n}\nexport class ApolloServer extends ApolloServerBase {\n  createGraphQLServerOptions(req, res) {\n    return super.graphQLServerOptions({\n      req,\n      res\n    });\n  }\n\n  supportsUploads() {\n    return true;\n  }\n\n  createHandler({\n    cors,\n    onHealthCheck\n  } = {}) {\n    const promiseWillStart = this.willStart();\n    const corsHeaders = new Headers();\n\n    if (cors) {\n      if (cors.methods) {\n        if (typeof cors.methods === `string`) {\n          corsHeaders.set(`access-control-allow-methods`, cors.methods);\n        } else if (Array.isArray(cors.methods)) {\n          corsHeaders.set(`access-control-allow-methods`, cors.methods.join(`,`));\n        }\n      }\n\n      if (cors.allowedHeaders) {\n        if (typeof cors.allowedHeaders === `string`) {\n          corsHeaders.set(`access-control-allow-headers`, cors.allowedHeaders);\n        } else if (Array.isArray(cors.allowedHeaders)) {\n          corsHeaders.set(`access-control-allow-headers`, cors.allowedHeaders.join(`,`));\n        }\n      }\n\n      if (cors.exposedHeaders) {\n        if (typeof cors.exposedHeaders === `string`) {\n          corsHeaders.set(`access-control-expose-headers`, cors.exposedHeaders);\n        } else if (Array.isArray(cors.exposedHeaders)) {\n          corsHeaders.set(`access-control-expose-headers`, cors.exposedHeaders.join(`,`));\n        }\n      }\n\n      if (cors.credentials) {\n        corsHeaders.set(`access-control-allow-credentials`, `true`);\n      }\n\n      if (typeof cors.maxAge === `number`) {\n        corsHeaders.set(`access-control-max-age`, cors.maxAge.toString());\n      }\n    }\n\n    return async (req, res) => {\n      const requestCorsHeaders = new Headers(corsHeaders);\n\n      if (cors && cors.origin) {\n        const requestOrigin = req.headers.origin;\n\n        if (typeof cors.origin === `string`) {\n          requestCorsHeaders.set(`access-control-allow-origin`, cors.origin);\n        } else if (requestOrigin && (typeof cors.origin === `boolean` || Array.isArray(cors.origin) && requestOrigin && cors.origin.includes(requestOrigin))) {\n          requestCorsHeaders.set(`access-control-allow-origin`, requestOrigin);\n        }\n\n        const requestAccessControlRequestHeaders = req.headers[`access-control-request-headers`];\n\n        if (!cors.allowedHeaders && requestAccessControlRequestHeaders) {\n          requestCorsHeaders.set(`access-control-allow-headers`, requestAccessControlRequestHeaders);\n        }\n      }\n\n      const requestCorsHeadersObject = Array.from(requestCorsHeaders).reduce((headersObject, [key, value]) => {\n        headersObject[key] = value;\n        return headersObject;\n      }, {});\n\n      if (req.method === `OPTIONS`) {\n        setHeaders(res, requestCorsHeadersObject);\n        return res.status(204).send(``);\n      }\n\n      if (req.url === `/.well-known/apollo/server-health`) {\n        const successfulResponse = () => {\n          setHeaders(res, _objectSpread({\n            \"Content-Type\": `application/json`\n          }, requestCorsHeadersObject));\n          return res.status(200).json({\n            status: `pass`\n          });\n        };\n\n        if (onHealthCheck) {\n          try {\n            await onHealthCheck(req);\n            successfulResponse();\n          } catch {\n            setHeaders(res, _objectSpread({\n              \"Content-Type\": `application/json`\n            }, requestCorsHeadersObject));\n            return res.status(503).json({\n              status: `fail`\n            });\n          }\n        } else {\n          return successfulResponse();\n        }\n      }\n\n      if (this.playgroundOptions && req.method === `GET`) {\n        const acceptHeader = req.headers.Accept || req.headers.accept;\n\n        if (acceptHeader && acceptHeader.includes(`text/html`)) {\n          const path = req.url || `/`;\n\n          const playgroundRenderPageOptions = _objectSpread({\n            endpoint: path\n          }, this.playgroundOptions);\n\n          setHeaders(res, _objectSpread({\n            \"Content-Type\": `text/html`\n          }, requestCorsHeadersObject));\n          return res.status(200).send(renderPlaygroundPage(playgroundRenderPageOptions));\n        }\n      }\n\n      const fileUploadHandler = async next => {\n        const contentType = req.headers[`content-type`] || req.headers[`Content-Type`];\n\n        if (contentType && contentType.startsWith(`multipart/form-data`) && typeof processFileUploads === `function`) {\n          try {\n            req.body = await processFileUploads(req, res, this.uploadsConfig || {});\n            return next();\n          } catch (error) {\n            throw formatApolloErrors([error], {\n              formatter: this.requestOptions.formatError,\n              debug: this.requestOptions.debug\n            });\n          }\n        } else {\n          return next();\n        }\n      };\n\n      return fileUploadHandler(() => graphqlVercel(async () => {\n        await promiseWillStart;\n        return this.createGraphQLServerOptions(req, res);\n      })(req, res));\n    };\n  }\n\n}"],"names":["setHeaders","res","headers","name","value","Object","entries","setHeader","graphqlVercel","options","Error","arguments","length","graphqlHandler","req","method","body","status","send","graphqlResponse","responseInit","runHttpQuery","query","request","convertNodeHttpToRequest","error","statusCode","message","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","obj","configurable","writable","ApolloServer","ApolloServerBase","createGraphQLServerOptions","graphQLServerOptions","supportsUploads","createHandler","cors","onHealthCheck","promiseWillStart","willStart","corsHeaders","Headers","methods","set","Array","isArray","join","allowedHeaders","exposedHeaders","credentials","maxAge","toString","requestCorsHeaders","origin","requestOrigin","includes","requestAccessControlRequestHeaders","requestCorsHeadersObject","from","reduce","headersObject","url","successfulResponse","json","playgroundOptions","acceptHeader","Accept","accept","path","playgroundRenderPageOptions","endpoint","renderPlaygroundPage","fileUploadHandler","next","contentType","startsWith","processFileUploads","uploadsConfig","formatApolloErrors","formatter","requestOptions","formatError","debug"],"mappings":"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"}